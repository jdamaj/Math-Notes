
\subsection{Ultrafilters}

\begin{definition}
    A filter on $I$ is a subset $\cD \subseteq \cP(I)$ such that 
    \begin{enumerate}[label = (\roman*)]
        \item $\vn \not\in \cD$, $I \in \cD$
        \item If $A \in cD$, $B \supseteq A \to B \in \cD$ 
        \item if $A, B \in \cD$, then $A \cap B \in \cD$ 
    \end{enumerate} 
\end{definition}

\begin{example}
    \begin{enumerate}[label = (\alph*)]
        \item $I  = \bR$, $\cD = \{X \subseteq \bR \, | \, X$ has full measure $\}$ eg. $\lambda(\bR \setminus X) = 0$
        \item $I  = \bR$, $\cD = \{X \subseteq \, | \, X$ is meager $\}$ 
        \item For $\kappa \le |I|$, $\cD = \{X \subseteq I \, | \, |I \setminus X| < \kappa\}$ \\
        For $\kappa = \aleph_0$, $\cD$ is called the Frechet filter or the cofinite filter
        \item For $x \in I$, $\cD = \{X \subseteq I \, | \, x \in X\}$ called principle filter 
        \item For $I = \bN$, $\{X \subseteq N \, \, \lim_{ n \to \infty} \frac{|X \cap n|}{n} = 1\}$ 
    \end{enumerate}
\end{example}

\begin{definition}
    $\cD$ is an ultrafilter if it is a filter and for all $X \subseteq I$, either $X \in \cD$ or $X^C \in \cD$ 
\end{definition}

\begin{itemize}
    \item principle filters are ultrafilters 
\end{itemize}

\noindent
Observataion: If $\cU$ is an ultra filter, $A \cup B \in \cU \ifff A \in \cU$ or $B \in \cU$ \\
If $A, B \not\in \cU$, $A^C, B^C \in \cU$ so $A^C \cap B^C \in \cU$ so $(A^C \cap B^C)^C =A \cup B \not\in \cU$ \\
Similarly, $C \cap D \not\in \cU \ifff C \not\in \cU$ and $D \not\in\cU$ 

\begin{theorem}
    Every filter $\cD$ on $I$ can be extended to an ultrafilter
\end{theorem}

\begin{pf}
    Let $\cA = \{ \cF \subseteq \cP(I) \, | \, \cF$ filter and $\cD \subseteq \cF\}$. To apply Zorn's lemma to get a maximal $\cU$ in $\cA$, we need to show if $\cC \subseteq \cA$ is a chain then $\bigcup \cC \in \cA$. Clear that $\vn \not \in \bigcup \cC, I \in \bigcup \cC$, and closed upwards. For $A, B \in \bigcup \cC$, $\ex \cF, \cF' \in \cC$ such that $A \in \cF, B \in \cF'$. WLOG assume $A, B \in \cF$, then $A \cap B \in \cF' \subseteq \bigcup \cC$ \\
    Suppose $\cU$ is a maximal filter. We show that it is an ultrafilter. Take $X \subseteq I$. We show $X \in \cU$ or $X^C \in \cU$. Suppose not. Let $\cD_0 =$ filter generated by $X, \cU = \{Y \, | \, \ex V \in \cU \, Y \supseteq V \cap X\}$, $\cD_1  =\{Z \, | \, \ex W \in \cU \, Z \supseteq W \cap X^C\}$. $\cD_0, \cD_1$ satsify all conditions except we dont know if they contain $\vn$. If $\vn \in \cD_0, \cD_1$, there is $V \in \cU$ $V \cap X = \vn$, $W \in \cU$ $W \cap X^C = \vn$ so $V \subseteq X^C, W \subseteq X$ so $V \cap W = \vn$, contradicting $V, W \in \cU$ 
\end{pf}

\noindent
To get a nonprinciple ultrafilter take $\cD = \{X \subseteq I \, | \, I \setminus X$ finte $\}$ and extend to ultrafilter $\supseteq \cD$ \\
Observataion: $\fa x \in I$, $I \setminus \{x\} \in \cD \subseteq \cU$ so $\{x\} \not\in \cU$ \\
An ultrafilter is not principle $\ifff \cU \supseteq $ Frechet filter \\
Observataion: If $\cU$ is an ultrafilter and contains a finite set $\cA = \{a_0, \ldots, a_n\}$ then $\cU$ is princtiple since $\cA = \{a_0\} \cup \{a_1\} \cup \cdots \cup \{a_n\}$ 

\begin{definition}[Ultraproduct]
    $I$ an infinte set, $\cU$ an ultafilter of $I$, $\{\cM_i \, : \, i \in I\}$ a collection of $cL$ structures. Define $\cM = \prod_{i \in I} \cM_i /\cU$ as follows: 
    \begin{itemize}
        \item Given $g, h \in \prod_{i \in I}M_I$, $g \sim h$ iff $\{i \in I \, | \, g(i) = h(i)\} \in \cU$. $M = \prod_{i \in I}M_i/\sim$ 
        \item $c^{\cM} = [ i \mapsto c^{\cM_i}]$ 
        \item $f^{\cM}(g_1, \ldots, g_n) = [i \mapsto f^{\cM_i}(g_1(i), \ldots, g_n(i))]$
        \item $(g_1, \ldots, g_n) \in R^{\cM} \iff \{i \in I \, | \, (g_1(i), \ldots, g_n(i)) \in R^{\cM_i}\} \in \cU$ 
    \end{itemize}
\end{definition}

\noindent
Claims: 
\begin{enumerate}
    \item $\sim$ is an equivalence relation on $\prod_{i \in I}M_i$ \\
    Reflexivity, symmetry clear. $g \sim h, h \sim f \to g \sim f$ since $\{ i \, | \, g(i)=f(i)\}\supseteq \{ i \, | \, g(i)=h(i)\} \cap \{i \, | \, h(i) = f(i)\}$ 
    \item $f^\cM$ is well defined. \\
    $g_1 \sim g_1', \ldots, g_n \sim g_n' \to f^{\cM}(g_1, \ldots, g_n) = f^{\cM}(g_1', \ldots, g_n')$ since $\{ i \, | \, f^{\cM_i}(g_1(i), \ldots, g_n(i)) = f^{\cM_i}(g_1'(i), \ldots, g_n'(i))\} \supseteq \bigcap_{j=1}^n\{ i \, | \, g_j(i) = g_j'(i)\}$ 
    \item $R^{\cM}$ well defined for a similar reason. 
\end{enumerate}

\begin{definition}
    The $\cU$ ultrapower of $\cM$ is $\prod \cM / \cU$ 
\end{definition}

\begin{itemize}
    \item $\cM \preceq \prod \cM /\cU$ 
\end{itemize}